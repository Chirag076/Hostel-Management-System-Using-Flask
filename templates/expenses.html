{% extends 'base.html' %}

{% block title %}Expenses{% endblock %}

{% block content %}
<!-- Summary Cards -->
<div class="container-fluid mt-4">
    <div class="row">
        <!-- Current Month Income -->
        <div class="col-md-3">
            <div class="card bg-success text-white mb-4 shadow-lg" style="animation: slideInLeft 0.5s;">
                <div class="card-body">
                    <h5 class="card-title">Current Month Income</h5>
                    <h2 class="display-4">Rs {{ total_income_current }}</h2>
                    <p class="mb-0">Total fees collected for {{ month_names[current_month] }} {{ current_year }}</p>
                </div>
            </div>
        </div>
        <!-- Current Month Expenses -->
        <div class="col-md-3">
            <div class="card bg-danger text-white mb-4 shadow-lg" style="animation: slideInUp 0.5s;">
                <div class="card-body">
                    <h5 class="card-title">Current Month Expenses</h5>
                    <h2 class="display-4">Rs {{ total_expenses_current }}</h2>
                    <p class="mb-0">Total expenses for {{ month_names[current_month] }} {{ current_year }}</p>
                </div>
            </div>
        </div>
        <!-- Current Month Balance -->
        <div class="col-md-3">
            <div class="card bg-primary text-white mb-4 shadow-lg" style="animation: slideInUp 0.5s;">
                <div class="card-body">
                    <h5 class="card-title">Current Month Balance</h5>
                    <h2 class="display-4">Rs {{ remaining_balance_current }}</h2>
                    <p class="mb-0">Remaining balance for {{ month_names[current_month] }} {{ current_year }}</p>
                </div>
            </div>
        </div>
        <!-- Previous Month Summary -->
        <div class="col-md-3">
            <div class="card bg-info text-white mb-4 shadow-lg" style="animation: slideInRight 0.5s;">
                <div class="card-body">
                    <h5 class="card-title">Previous Month Summary</h5>
                    <p class="mb-2">Income: Rs {{ total_income_previous }}</p>
                    <p class="mb-2">Expenses: Rs {{ total_expenses_previous }}</p>
                    <p class="mb-0">Balance: Rs {{ remaining_balance_previous }}</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add New Expense Form -->
<div class="container-fluid mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-lg border-0 rounded-lg" style="animation: fadeIn 0.5s;">
                <div class="card-header bg-primary text-white">
                    <h3 class="text-center mb-0">Add New Expense</h3>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('expenses') }}" class="needs-validation" novalidate>
                        {{ form.hidden_tag() }}
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="item_name" class="form-label">Item Name</label>
                                {{ form.item_name(class="form-control form-control-lg shadow-sm", placeholder="Enter item name", required="required") }}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="price" class="form-label">Price</label>
                                <div class="input-group">
                                    <span class="input-group-text">Rs</span>
                                    {{ form.price(class="form-control form-control-lg shadow-sm", placeholder="0.00", required="required") }}
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="date" class="form-label">Date</label>
                                {{ form.date(class="form-control form-control-lg shadow-sm", type="date", required="required") }}
                            </div>
                        </div>
                        <div class="d-grid gap-2">
                            {{ form.submit(class="btn btn-primary btn-lg shadow-sm") }}
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Filter Section -->
<div class="container-fluid mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-lg border-0 rounded-lg" style="animation: fadeIn 0.5s;">
                <div class="card-header bg-info text-white">
                    <h3 class="text-center mb-0">Filter Expenses</h3>
                </div>
                <div class="card-body">
                    <form method="GET" action="{{ url_for('expenses') }}" class="row g-3">
                        <div class="col-md-5">
                            <label for="year" class="form-label">Year</label>
                            <select name="year" id="year" class="form-select form-select-lg shadow-sm">
                                {% for y in range(current_year - 5, current_year + 1) %}
                                    <option value="{{ y }}" {% if y == current_year %}selected{% endif %}>{{ y }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-5">
                            <label for="month" class="form-label">Month</label>
                            <select name="month" id="month" class="form-select form-select-lg shadow-sm">
                                {% for m in range(1, 13) %}
                                    <option value="{{ m }}" {% if m == current_month %}selected{% endif %}>{{ month_names[m] }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-2 d-flex align-items-end">
                            <button type="submit" class="btn btn-info btn-lg w-100 shadow-sm">
                                <i class="fas fa-filter"></i> Filter
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Current Month Expenses Table -->
<div class="container-fluid mt-4">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card shadow-lg border-0 rounded-lg" style="animation: fadeIn 0.5s;">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h3 class="mb-0">Current Month Expenses</h3>
                    <a href="{{ url_for('export_pdf', year=current_year, month=current_month) }}" class="btn btn-light">
                        <i class="fas fa-file-pdf"></i> Export PDF
                    </a>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Item Name</th>
                                    <th>Price</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for expense in expenses_current %}
                                <tr class="align-middle">
                                    <td>{{ expense.item_name }}</td>
                                    <td>Rs {{ expense.price }}</td>
                                    <td>{{ expense.date.strftime('%Y-%m-%d') }}</td>
                                    <td>
                                        <div class="btn-group" role="group">
                                            <button type="button" class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#editModal{{ expense.id }}" title="Edit">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal{{ expense.id }}" title="Delete">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Previous Month Expenses Table -->
<div class="container-fluid mt-4">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card shadow-lg border-0 rounded-lg" style="animation: fadeIn 0.5s;">
                <div class="card-header bg-info text-white">
                    <h3 class="mb-0">Previous Month Expenses</h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Item Name</th>
                                    <th>Price</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for expense in expenses_previous %}
                                <tr class="align-middle">
                                    <td>{{ expense.item_name }}</td>
                                    <td>Rs {{ expense.price }}</td>
                                    <td>{{ expense.date.strftime('%Y-%m-%d') }}</td>
                                    <td>
                                        <div class="btn-group" role="group">
                                            <button type="button" class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#editModal{{ expense.id }}" title="Edit">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal{{ expense.id }}" title="Delete">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Edit Modals -->
{% for expense in expenses_current + expenses_previous %}
<div class="modal fade" id="editModal{{ expense.id }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-warning">
                <h5 class="modal-title">Edit Expense</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="{{ url_for('edit_expense', expense_id=expense.id) }}" method="POST">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="item_name" class="form-label">Item Name</label>
                        <input type="text" class="form-control" name="item_name" value="{{ expense.item_name }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="price" class="form-label">Price</label>
                        <input type="number" step="0.01" class="form-control" name="price" value="{{ expense.price }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="date" class="form-label">Date</label>
                        <input type="date" class="form-control" name="date" value="{{ expense.date.strftime('%Y-%m-%d') }}" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-warning">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Modals -->
<div class="modal fade" id="deleteModal{{ expense.id }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">Delete Expense</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this expense?</p>
                <p><strong>Item:</strong> {{ expense.item_name }}</p>
                <p><strong>Price:</strong> Rs {{ expense.price }}</p>
                <p><strong>Date:</strong> {{ expense.date.strftime('%Y-%m-%d') }}</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form action="{{ url_for('delete_expense', expense_id=expense.id) }}" method="POST" class="d-inline">
                    <button type="submit" class="btn btn-danger">Delete</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endfor %}

<!-- Custom CSS -->
<style>
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes slideInLeft {
        from { transform: translateX(-100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }

    @keyframes slideInRight {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }

    @keyframes slideInUp {
        from { transform: translateY(100%); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }

    .card {
        transition: transform 0.3s ease;
    }

    .card:hover {
        transform: translateY(-5px);
    }

    .table-hover tbody tr:hover {
        background-color: rgba(0, 123, 255, 0.1);
        transform: scale(1.01);
        transition: all 0.3s ease;
    }

    .btn-group .btn {
        transition: all 0.3s ease;
    }

    .btn-group .btn:hover {
        transform: scale(1.1);
    }

    .form-control:focus, .form-select:focus {
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
        border-color: #86b7fe;
    }
</style>

<!-- Add Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

{% endblock %}
